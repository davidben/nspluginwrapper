---
 Makefile |   36 ++++++++++++++++++++++++++++++++++++
 1 file changed, 36 insertions(+)

Index: nspluginwrapper-1.2.2/Makefile
===================================================================
--- nspluginwrapper-1.2.2.orig/Makefile
+++ nspluginwrapper-1.2.2/Makefile
@@ -74,21 +74,23 @@
 X_LDFLAGS = -L$(x11prefix)/$(lib64) -lX11 -lXt
 ifneq (,$(findstring $(OS),netbsd dragonfly))
 X_LDFLAGS += -Wl,--rpath,$(x11prefix)/$(lib64)
 endif
 
 ARCH_32 = $(ARCH)
 ifeq ($(biarch), yes)
 ARCH_32 = $(TARGET_ARCH)
+ifeq (,$(USE_SYSTEM_LSB))
 LSB_LIBS = $(LSB_OBJ_DIR)/libc.so $(LSB_OBJ_DIR)/libgcc_s_32.so
 LSB_LIBS += $(LSB_CORE_STUBS:%=$(LSB_OBJ_DIR)/%.so)
 LSB_LIBS += $(LSB_CORE_STATIC_STUBS:%=$(LSB_OBJ_DIR)/%.a)
 LSB_LIBS += $(LSB_DESKTOP_STUBS:%=$(LSB_OBJ_DIR)/%.so)
 endif
+endif
 
 LSB_TOP_DIR = $(SRC_PATH)/lsb-build
 LSB_INC_DIR = $(LSB_TOP_DIR)/headers
 LSB_SRC_DIR = $(LSB_TOP_DIR)/stub_libs
 LSB_OBJ_DIR = lsb-build-$(ARCH_32)
 LSB_CORE_STUBS = $(shell cat $(LSB_SRC_DIR)/core_filelist)
 LSB_CORE_STATIC_STUBS = $(shell cat $(LSB_SRC_DIR)/core_static_filelist)
 LSB_DESKTOP_STUBS = $(shell cat $(LSB_SRC_DIR)/desktop_filelist)
@@ -114,17 +116,21 @@
 npviewer_RAWSRCS = npw-viewer.c npw-common.c npw-malloc.c npw-rpc.c rpc.c debug.c utils.c npruntime.c
 npviewer_SOURCES = $(npviewer_RAWSRCS:%.c=$(SRC_PATH)/src/%.c)
 npviewer_OBJECTS = $(npviewer_RAWSRCS:%.c=npviewer-%.o)
 ifeq ($(biarch),yes)
 npviewer_CFLAGS  = $(CFLAGS_32)
 npviewer_CFLAGS += -I$(LSB_INC_DIR)
 npviewer_CFLAGS += -I$(LSB_INC_DIR)/glib-2.0
 npviewer_CFLAGS += -I$(LSB_INC_DIR)/gtk-2.0
+ifeq (,$(USE_SYSTEM_LSB))
 npviewer_LDFLAGS = $(LDFLAGS_32) -L$(LSB_OBJ_DIR)
+else
+npviewer_LDFLAGS = $(LDFLAGS_32) -L/usr/lib32/
+endif
 npviewer_LDFLAGS += -lgtk-x11-2.0 -lgdk-x11-2.0 -lgobject-2.0 -ldl -lglib-2.0 -lgthread-2.0 -lX11 -lXt
 else
 npviewer_CFLAGS += $(GTK_CFLAGS)
 npviewer_LDFLAGS = $(GTK_LDFLAGS) $(X_LDFLAGS)
 endif
 npviewer_CFLAGS  += $(MOZILLA_CFLAGS)
 npviewer_LDFLAGS += $(libdl_LDFLAGS) $(libpthread_LDFLAGS) -lgthread-2.0
 ifeq ($(TARGET_OS):$(TARGET_ARCH),linux:i386)
@@ -152,27 +158,35 @@
 
 libxpcom_LIBRARY = libxpcom.so
 libxpcom_RAWSRCS = libxpcom.c debug.c
 libxpcom_SOURCES = $(libxpcom_RAWSRCS:%.c=$(SRC_PATH)/src/%.c)
 libxpcom_OBJECTS = $(libxpcom_RAWSRCS:%.c=libxpcom-%.o)
 libxpcom_CFLAGS  = $(PIC_CFLAGS)
 ifeq ($(biarch),yes)
 libxpcom_CFLAGS += -I$(LSB_INC_DIR)
+ifeq (,$(USE_SYSTEM_LSB))
 libxpcom_LDFLAGS = $(LDFLAGS_32) -L$(LSB_OBJ_DIR)
+else
+libxpcom_LDFLAGS = $(LDFLAGS_32) -L/usr/lib32/
+endif
 endif
 
 libnoxshm_LIBRARY = libnoxshm.so
 libnoxshm_RAWSRCS = libnoxshm.c
 libnoxshm_SOURCES = $(libnoxshm_RAWSRCS:%.c=$(SRC_PATH)/src/%.c)
 libnoxshm_OBJECTS = $(libnoxshm_RAWSRCS:%.c=libnoxshm-%.o)
 libnoxshm_CFLAGS  = $(PIC_CFLAGS)
 ifeq ($(biarch),yes)
 libnoxshm_CFLAGS += -I$(LSB_INC_DIR)
+ifeq (,$(USE_SYSTEM_LSB))
 libnoxshm_LDFLAGS = $(LDFLAGS_32) -L$(LSB_OBJ_DIR)
+else
+libxpcom_LDFLAGS = $(LDFLAGS_32) -L/usr/lib32/
+endif
 endif
 
 npconfig_PROGRAM = npconfig
 npconfig_RAWSRCS = npw-config.c
 npconfig_SOURCES = $(npconfig_RAWSRCS:%.c=$(SRC_PATH)/src/%.c)
 npconfig_OBJECTS = $(npconfig_RAWSRCS:%.c=npconfig-%.o)
 npconfig_CFLAGS  = $(GLIB_CFLAGS)
 npconfig_LDFLAGS = $(GLIB_LDFLAGS) $(libdl_LDFLAGS)
@@ -230,25 +244,27 @@
 FILES		+= $(wildcard src/*.map)
 FILES		+= $(wildcard tests/*.html)
 FILES		+= $(wildcard tests/*.c tests/*.h)
 FILES		+= $(wildcard npapi/*.h npapi/nspr/*.h npapi/nspr/obsolete/*.h)
 FILES		+= $(LSB_TOP_DIR)/headers/core_filelist
 FILES		+= $(addprefix $(LSB_TOP_DIR)/headers/,$(shell cat $(LSB_TOP_DIR)/headers/core_filelist))
 FILES		+= $(LSB_TOP_DIR)/headers/desktop_filelist
 FILES		+= $(addprefix $(LSB_TOP_DIR)/headers/,$(shell cat $(LSB_TOP_DIR)/headers/desktop_filelist))
+ifeq (,$(USE_SYSTEM_LSB))
 FILES		+= $(LSB_SRC_DIR)/LibNameMap.txt
 FILES		+= $(LSB_SRC_DIR)/core_filelist
 FILES		+= $(LSB_SRC_DIR)/core_static_filelist
 FILES		+= $(LSB_SRC_DIR)/desktop_filelist
 FILES		+= $(patsubst %,$(LSB_SRC_DIR)/%.c,$(LSB_CORE_STUBS))
 FILES		+= $(patsubst %,$(LSB_SRC_DIR)/%.Version,$(LSB_CORE_STUBS))
 FILES		+= $(patsubst %,$(LSB_SRC_DIR)/%.c,$(LSB_CORE_STATIC_STUBS))
 FILES		+= $(patsubst %,$(LSB_SRC_DIR)/%.c,$(LSB_DESKTOP_STUBS))
 FILES		+= $(patsubst %,$(LSB_SRC_DIR)/%.Version,$(LSB_DESKTOP_STUBS))
+endif
 
 all: $(TARGETS)
 
 clean:
 	rm -f $(TARGETS) *.o *.os
 	rm -rf $(LSB_OBJ_DIR)
 
 distclean: clean
@@ -373,41 +389,61 @@
 	svn commit -m "Generated by svn2cl." ChangeLog
 
 $(npwrapper_LIBRARY): $(npwrapper_OBJECTS)
 	$(CC) -o $@ $(DSO_LDFLAGS) $(npwrapper_OBJECTS) $(npwrapper_LDFLAGS)
 
 npwrapper-%.os: $(SRC_PATH)/src/%.c
 	$(CC) -o $@ -c $< $(PIC_CFLAGS) $(CPPFLAGS) $(npwrapper_CFLAGS) -DBUILD_WRAPPER
 
+ifeq (,$(USE_SYSTEM_LSB))
 $(npviewer_PROGRAM): $(npviewer_OBJECTS) $(npviewer_MAPFILE) $(LSB_OBJ_DIR) $(LSB_LIBS)
 	$(CC) $(LDFLAGS_32) -o $@ $(npviewer_OBJECTS) $(npviewer_LDFLAGS)
+else
+$(npviewer_PROGRAM): $(npviewer_OBJECTS) $(npviewer_MAPFILE)
+	$(CC) $(LDFLAGS_32) -o $@ $(npviewer_OBJECTS) $(npviewer_LDFLAGS)
+endif
 
 npviewer-%.o: $(SRC_PATH)/src/%.c
 	$(CC) $(CFLAGS_32) -o $@ -c $< $(CPPFLAGS) $(npviewer_CFLAGS) -DBUILD_VIEWER
 
 npviewer-%.o: $(SRC_PATH)/src/%.cpp
 	$(CXX) $(CFLAGS_32) -o $@ -c $< $(CPPFLAGS) $(npviewer_CFLAGS) -DBUILD_VIEWER
 
+ifeq (,$(USE_SYSTEM_LSB))
 $(npplayer_PROGRAM): $(npplayer_OBJECTS) $(npplayer_MAPFILE) $(LSB_OBJ_DIR) $(LSB_LIBS)
 	$(CC) $(LDFLAGS) -o $@ $(npplayer_OBJECTS) $(npplayer_LDFLAGS)
+else
+$(npplayer_PROGRAM): $(npplayer_OBJECTS) $(npplayer_MAPFILE)
+	$(CC) $(LDFLAGS) -o $@ $(npplayer_OBJECTS) $(npplayer_LDFLAGS)
+endif
 
 npplayer-%.o: $(SRC_PATH)/src/%.c
 	$(CC) $(CFLAGS) -o $@ -c $< $(CPPFLAGS) $(npplayer_CFLAGS) -DBUILD_PLAYER
 npplayer-%.o: $(SRC_PATH)/src/tidy/%.c
 	$(CC) $(CFLAGS) -o $@ -c $< $(CPPFLAGS) $(npplayer_CFLAGS) -DBUILD_PLAYER
 
+ifeq (,$(USE_SYSTEM_LSB))
 $(libxpcom_LIBRARY): $(libxpcom_OBJECTS) $(LSB_OBJ_DIR) $(LSB_LIBS)
 	$(CC) $(LDFLAGS_32) $(DSO_LDFLAGS) -o $@ $(libxpcom_OBJECTS) $(libxpcom_LDFLAGS) -Wl,$(LD_soname),libxpcom.so
+else
+$(libxpcom_LIBRARY): $(libxpcom_OBJECTS)
+	$(CC) $(LDFLAGS_32) $(DSO_LDFLAGS) -o $@ $(libxpcom_OBJECTS) $(libxpcom_LDFLAGS) -Wl,$(LD_soname),libxpcom.so
+endif
 
 libxpcom-%.o: $(SRC_PATH)/src/%.c
 	$(CC) $(CFLAGS_32) -o $@ -c $< $(CPPFLAGS) $(libxpcom_CFLAGS) -DBUILD_XPCOM
 
+ifeq (,$(USE_SYSTEM_LSB))
 $(libnoxshm_LIBRARY): $(libnoxshm_OBJECTS) $(LSB_OBJ_DIR) $(LSB_LIBS)
 	$(CC) $(LDFLAGS_32) $(DSO_LDFLAGS) -o $@ $(libnoxshm_OBJECTS) $(libnoxshm_LDFLAGS) -Wl,$(LD_soname),libnoxshm.so
+else
+$(libnoxshm_LIBRARY): $(libnoxshm_OBJECTS)
+	$(CC) $(LDFLAGS_32) $(DSO_LDFLAGS) -o $@ $(libnoxshm_OBJECTS) $(libnoxshm_LDFLAGS) -Wl,$(LD_soname),libnoxshm.so
+endif
 
 libnoxshm-%.o: $(SRC_PATH)/src/%.c
 	$(CC) $(CFLAGS_32) -o $@ -c $< $(CPPFLAGS) $(libnoxshm_CFLAGS)
 
 $(npconfig_PROGRAM): $(npconfig_OBJECTS)
 	$(CC) -o $@ $(npconfig_OBJECTS) $(npconfig_LDFLAGS)
 
 npconfig-%.o: $(SRC_PATH)/src/%.c
